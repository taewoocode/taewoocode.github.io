---
layout: post
title: Spring Basic 07 - Bean Scope
subtitle: ""
categories: framework
tags: spring
comments: false
---

## **빈 스코프란**?

스프링 빈이 스프링 컨테이너의 시작과 함께 생성되어서 스프링 컨테이너가 종료될 때 까지 유지된다.
스프링 빈은 기본적으로 싱글톤 스코프로 생성되기 때문이다. 스코프는 번역 그대로 빈이 존재할
수 있는 범위를 뜻한다.

## **스프링의 다양한 스코프**

- **싱글톤**: 기본 스코프, 스프링 컨테이너의 시작과 종료까지 유지되는 가장 넓은 범위의 스코프이다.
- **프로토타입**: 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입까지만 관여하고 더는 관리하지 않는 매우짧은 범위의 스코프이다.
- **웹 관련 스코프**
    - **request**: 웹 요청이 들어오고 나갈때 까지 유지되는 스코프이다.
      **session**: 웹 세션이 생성되고 종료될 때 까지 유지되는 스코프이다.
      **application**: 웹의 서블릿 컨텍스트와 같은 범위로 유지되는 스코프이다.

## 프로토타입 스코프

- 싱글톤 스코프의 빈을 조회하면 스프링 컨테이너는 항상 같은 인스턴스의 스프링 빈을 반환한다. 반면에 프로토타입 스코프를 스프링 컨테이너에 조회하면 스프링 컨테이너는 항상 새로운 인스턴스를 반환한다.

### 싱글톤 빈 요청

- 싱글톤 스코의 빈을 스프링 컨테이너에 요청한다.
- 스프링 컨테이너는 본인이 관리하는 스프링 빈을 반환한다.
- 이후에 스프링 컨테이너에 같은 요청이 들어와도 같은 객체 인스턴스를 반환한다.

### 프로토타입 빈 요청

- 프로토타입 스코프의 빈을 스프링 컨테이너에게 요청한다.
- 스프링 컨테이너는 이 시점에 프로토타입 빈을 생성하고, 필요한 의존관계를 주입한다.
- 스프링 컨테이너는 생성한 프로토타입 빈을 클라이언트에게 반환한다.
- 스프링 컨테이너에 같은 요청이 온다면 항상 새로운 프로토타입 빈을 생성해서 반환한다.

### 핵심은?

- 스프링 컨테이너는 프로토타입 빈을 생성하고, 의존관계 주입, 초기화까지만 처리한다. 클라이언트에 빈을 반환하고, 이후 스프링 컨테이너는 생성된 프로토타입 빈을 관리하지 않는다. 프로토타입 빈을 관리할 책임은 프로토타입 빈을 받은 클라이언트에게 있다. 그래서 @PreDestroy 같은 종료 메서드가 호출되지 않는다.

## 싱글톤 스코프 빈 테스트
<img width="700" alt="image" src="https://github.com/user-attachments/assets/be4fbc8b-3e09-4c9c-b226-afaeba2c901c">
<img width="641" alt="image" src="https://github.com/user-attachments/assets/9d5085be-68db-4a79-93f5-f71ea4630c00">

## 프로토타입 스코프 빈 테스트
<img width="691" alt="image" src="https://github.com/user-attachments/assets/9841b38e-2f85-4249-b1c1-7fb9c5cc302f">
<img width="563" alt="image" src="https://github.com/user-attachments/assets/6fb983f2-f8c4-4346-903a-4bb5d9bf2e83">

싱글톤 빈은 스프링 컨테이너 생성 시점에 초기화 메서드가 실행 되지만, 프로토타입 스코프의 빈은 스프링 컨테
이너에서 빈을 조회할 때 생성되고, 초기화 메서드도 실행된다.프로토타입 빈을 2번 조회했으므로 완전히 다른 스프링 빈이 생성되고, 초기화도 2번 실행된 것을 확인할 수 있다.
싱글톤 빈은 스프링 컨테이너가 관리하기 때문에 스프링 컨테이너가 종료될 때 빈의 종료 메서드가 실행되지만,
프로토타입 빈은 스프링 컨테이너가 생성과 의존관계 주입 그리고 초기화 까지만 관여하고, 더는 관리하지 않는다. 
따라서 프로토타입 빈은 스프링 컨테이너가 종료될 때 `@PreDestroy` 같은 종료 메서드가 전혀 실행되지 않는다.

## **프로토타입 빈의 특징 정리**

- 스프링 컨테이너에 요청할 때 마다 새로 생성된다.
- 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입 그리고 초기화까지만 관여한다.
- 프로토타입 빈을 조회한 클라이언트가 관리해야 한다. → 종료 메서드에 대한 호출도 클라이언트가 직접 해야 한다.


## Reference

김영한님의 스프링 강의 정리